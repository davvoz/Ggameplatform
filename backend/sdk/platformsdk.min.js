/**
 * Platform SDK - Minified Version
 * Version: 1.0.0
 * A universal SDK for integrating games with the HTML5 Game Platform
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).PlatformSDK=t()}(this,function(){"use strict";const e="1.0.0";class t{constructor(){this.isInitialized=!1,this.isPlatformReady=!1,this.eventCallbacks=new Map,this.messageQueue=[],this.config=null,this.state={score:0,level:1,isPaused:!1},this.boundMessageHandler=this.handlePlatformMessage.bind(this)}async init(e={}){return this.isInitialized?(console.warn("[PlatformSDK] Already initialized"),void 0):(this.log("Initializing Platform SDK..."),window.self===window.top&&console.warn("[PlatformSDK] Not running in iframe - platform features may not be available"),window.addEventListener("message",this.boundMessageHandler),this.isInitialized=!0,this.sendReady(),this.log("Platform SDK initialized successfully"),this.waitForPlatform(e.timeout||5e3))}waitForPlatform(e){return new Promise(t=>{const s=setTimeout(()=>{this.isPlatformReady||console.warn("[PlatformSDK] Platform ready timeout"),t()},e),i=()=>{this.isPlatformReady?(clearTimeout(s),t()):setTimeout(i,100)};i()})}handlePlatformMessage(e){const t=e.data;if(this.isValidMessage(t)){switch(this.log("Received platform message:",t),t.type){case"config":this.handleConfig(t.payload);break;case"start":this.handleStart(t.payload);break;case"pause":this.handlePause(t.payload);break;case"resume":this.handleResume(t.payload);break;case"exit":this.handleExit(t.payload);break;default:this.log("Unknown message type:",t.type)}this.triggerEvent(t.type,t.payload)}}isValidMessage(t){return t&&"object"==typeof t&&"string"==typeof t.type&&t.protocolVersion===e}handleConfig(e){this.config=e,this.isPlatformReady=!0,this.log("Platform ready with config:",e),this.processMessageQueue()}handleStart(e){this.log("Game start signal received")}handlePause(e){this.state.isPaused=!0,this.log("Game pause signal received")}handleResume(e){this.state.isPaused=!1,this.log("Game resume signal received")}handleExit(e){this.log("Game exit signal received"),this.cleanup()}sendReady(){this.sendToPlatform("ready",{sdkVersion:e,timestamp:Date.now()})}sendScore(e,t={}){if("number"!=typeof e)return void console.error("[PlatformSDK] Score must be a number");this.state.score=e,this.sendToPlatform("scoreUpdate",{score:e,...t,timestamp:Date.now()})}gameOver(e,t={}){if("number"!=typeof e)return void console.error("[PlatformSDK] Final score must be a number");this.state.score=e,this.sendToPlatform("gameOver",{score:e,...t,timestamp:Date.now()})}levelCompleted(e,t={}){if("number"!=typeof e)return void console.error("[PlatformSDK] Level must be a number");this.state.level=e,this.sendToPlatform("levelCompleted",{level:e,...t,timestamp:Date.now()})}requestFullScreen(){this.sendToPlatform("requestFullScreen",{timestamp:Date.now()})}log(e,t=null){window.self===window.top?console.log("[PlatformSDK]",e,t||""):this.sendToPlatform("log",{message:e,data:t,timestamp:Date.now()})}on(e,t){if("function"!=typeof t)return void console.error("[PlatformSDK] Callback must be a function");this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(t)}off(e,t){if(this.eventCallbacks.has(e)){const s=this.eventCallbacks.get(e).indexOf(t);-1!==s&&this.eventCallbacks.get(e).splice(s,1)}}triggerEvent(e,t){this.eventCallbacks.has(e)&&this.eventCallbacks.get(e).forEach(e=>{try{e(t)}catch(e){console.error("[PlatformSDK] Error in event callback:",e)}})}sendToPlatform(t,s={}){const i={type:t,payload:s,timestamp:Date.now(),protocolVersion:e};this.isPlatformReady||"ready"===t?window.parent&&window.parent!==window.self&&window.parent.postMessage(i,"*"):this.messageQueue.push(i)}processMessageQueue(){for(;this.messageQueue.length>0;){const e=this.messageQueue.shift();window.parent.postMessage(e,"*")}}getState(){return{...this.state}}isPaused(){return this.state.isPaused}cleanup(){window.removeEventListener("message",this.boundMessageHandler),this.eventCallbacks.clear(),this.messageQueue=[],this.isInitialized=!1,this.isPlatformReady=!1,this.log("SDK cleaned up")}}const s=new t;return{init:e=>s.init(e),sendScore:(e,t)=>s.sendScore(e,t),gameOver:(e,t)=>s.gameOver(e,t),levelCompleted:(e,t)=>s.levelCompleted(e,t),requestFullScreen:()=>s.requestFullScreen(),on:(e,t)=>s.on(e,t),off:(e,t)=>s.off(e,t),getState:()=>s.getState(),isPaused:()=>s.isPaused(),log:(e,t)=>s.log(e,t),version:e,_instance:s}});
