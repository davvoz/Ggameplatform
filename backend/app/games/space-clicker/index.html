<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Clicker - Sample Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        .game-container {
            text-align: center;
            max-width: 600px;
            width: 100%;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            color: #ffd700;
            text-shadow: 2px 2px 8px rgba(255, 215, 0, 0.5);
        }

        .click-area {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            background: radial-gradient(circle, #4a90e2 0%, #2a5298 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .click-area:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(74, 144, 226, 0.5);
        }

        .click-area:active {
            transform: scale(0.95);
        }

        .planet {
            font-size: 8rem;
            user-select: none;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            gap: 20px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            flex: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }

        .controls {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .click-particle {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            animation: float-up 1s ease-out forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }

        .message {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 1.1rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .combo {
            color: #ff6b6b;
            font-weight: bold;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üöÄ Space Clicker</h1>
        <div class="score-display" id="score">0</div>
        
        <div class="click-area" id="clickArea">
            <div class="planet">ü™ê</div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Clicks</div>
                <div class="stat-value" id="clicks">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Level</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Combo</div>
                <div class="stat-value" id="combo">x1</div>
            </div>
        </div>

        <div class="message" id="message">
            Click the planet to collect space points!
        </div>

        <div class="controls">
            <button class="btn-primary" id="upgradeBtn">Upgrade (Cost: 100)</button>
            <button class="btn-danger" id="resetBtn">Reset Game</button>
        </div>
    </div>

    <!-- Platform SDK -->
    <script src="../../sdk/platformsdk.obf.js"></script>

    <!-- Game Logic -->
    <script>
        // Game State
        let score = 0;
        let clicks = 0;
        let level = 1;
        let pointsPerClick = 1;
        let combo = 1;
        let comboTimer = null;
        let upgradeCost = 100;
        let isPaused = false;

        // DOM Elements
        const scoreDisplay = document.getElementById('score');
        const clicksDisplay = document.getElementById('clicks');
        const levelDisplay = document.getElementById('level');
        const comboDisplay = document.getElementById('combo');
        const messageDisplay = document.getElementById('message');
        const clickArea = document.getElementById('clickArea');
        const upgradeBtn = document.getElementById('upgradeBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Initialize Platform SDK
        PlatformSDK.init({ timeout: 10000 })
            .then(() => {

                showMessage('üéÆ Connected to platform!');
                
                // Listen for platform events
                PlatformSDK.on('pause', () => {
                    isPaused = true;
                    showMessage('‚è∏Ô∏è Game Paused');
                });

                PlatformSDK.on('resume', () => {
                    isPaused = false;
                    showMessage('‚ñ∂Ô∏è Game Resumed');
                });

                PlatformSDK.on('start', () => {
                    showMessage('üöÄ Game Started!');
                });

                PlatformSDK.on('exit', () => {
                    showMessage('üëã Thanks for playing!');
                });
            })
            .catch(err => {

                showMessage('üéÆ Standalone Mode');
            });

        // Click Handler
        clickArea.addEventListener('click', (e) => {
            if (isPaused) return;

            // Increment clicks
            clicks++;
            clicksDisplay.textContent = clicks;

            // Calculate points with combo (arrotonda per evitare decimali)
            const points = Math.floor(pointsPerClick * combo);
            score += points;
            scoreDisplay.textContent = Math.floor(score);

            // Send score to platform
            PlatformSDK.sendScore(Math.floor(score), {
                clicks: clicks,
                level: level,
                combo: combo.toFixed(1)
            });

            // Increase combo
            combo = Math.min(combo + 0.1, 5);
            comboDisplay.textContent = `x${combo.toFixed(1)}`;

            // Reset combo timer
            clearTimeout(comboTimer);
            comboTimer = setTimeout(() => {
                combo = 1;
                comboDisplay.textContent = 'x1';
            }, 2000);

            // Create click particle
            createParticle(e.clientX, e.clientY, `+${points}`);

            // Check for level up
            checkLevelUp();

            // Show click message
            if (clicks % 10 === 0) {
                showMessage(`üéâ ${clicks} clicks! Score: ${Math.floor(score)}`);
            }
        });

        // Upgrade Button
        upgradeBtn.addEventListener('click', () => {
            if (isPaused) return;
            
            if (score >= upgradeCost) {
                score -= upgradeCost;
                pointsPerClick++;
                level++;
                
                scoreDisplay.textContent = Math.floor(score);
                levelDisplay.textContent = level;
                
                upgradeCost = Math.floor(upgradeCost * 1.5);
                upgradeBtn.textContent = `Upgrade (Cost: ${upgradeCost})`;
                
                showMessage(`‚¨ÜÔ∏è Level ${level}! Now earning ${pointsPerClick} points per click!`);
                
                // Report level completion
                PlatformSDK.levelCompleted(level, {
                    pointsPerClick: pointsPerClick,
                    totalClicks: clicks,
                    upgradesCost: upgradeCost
                });

                // Send updated score
                PlatformSDK.sendScore(Math.floor(score));
            } else {
                showMessage(`‚ùå Need ${upgradeCost - Math.floor(score)} more points to upgrade!`);
            }
        });

        // Reset Button
        resetBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the game?')) {
                // Send game over
                PlatformSDK.gameOver(Math.floor(score), {
                    totalClicks: clicks,
                    finalLevel: level,
                    timePlayed: Math.floor(Date.now() / 1000)
                });

                // Reset game state
                score = 0;
                clicks = 0;
                level = 1;
                pointsPerClick = 1;
                combo = 1;
                upgradeCost = 100;

                // Update display
                scoreDisplay.textContent = '0';
                clicksDisplay.textContent = '0';
                levelDisplay.textContent = '1';
                comboDisplay.textContent = 'x1';
                upgradeBtn.textContent = 'Upgrade (Cost: 100)';
                
                showMessage('üîÑ Game Reset!');
            }
        });

        // Helper Functions
        function createParticle(x, y, text) {
            const particle = document.createElement('div');
            particle.className = 'click-particle';
            particle.textContent = text;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            document.body.appendChild(particle);

            setTimeout(() => {
                particle.remove();
            }, 1000);
        }

        function showMessage(text) {
            messageDisplay.innerHTML = text;
        }

        function checkLevelUp() {
            // Auto level-up every 500 points
            const targetScore = level * 500;
            if (score >= targetScore && score < targetScore + pointsPerClick * combo) {
                level++;
                pointsPerClick = level;
                levelDisplay.textContent = level;
                showMessage(`üéä Level ${level} Reached! Points per click: ${pointsPerClick}`);
                
                PlatformSDK.levelCompleted(level, {
                    autoLevelUp: true,
                    pointsPerClick: pointsPerClick
                });
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (isPaused) return;
            
            if (e.code === 'Space') {
                e.preventDefault();
                clickArea.click();
            }
        });

        // Show initial message
        setTimeout(() => {
            showMessage('üí° TIP: Press SPACE or click the planet!');
        }, 3000);
    </script>
</body>
</html>
